\section{Convolutional Neural Networks}

\subsection{Convolutional Neural Networks}

\subsubsection*{Limitations of ANN with FC layers}
\begin{itemize}
    \item On image recognition, spatial information(local structures) are important
    \item In FC layers, spatial information is lost!
    \item By subsampling input images, get spatial information $\implies$ \textit{convolution}
\end{itemize}
\begin{figures}
    \fig{cnn.png}{.5}
\end{figures}

\subsubsection*{Convolutional Layer}
\begin{itemize}
    \item Suppose input data(image) $x$ is
    \begin{equation}
        x:~W_i\times H_i\times D
    \end{equation}
    \item Suppose \# of channels $C\in\mathbb{N}$, stride $S\in\mathbb{N}$
    \item Suppose $c$-th filter and $c$-th bias $W_c$ and $b_c\in\mathbb{R}$
    \begin{equation}
        W_c:~W_f\times H_f\times D~(W_f\leq W_i,~H_f\leq H_i)
    \end{equation}
    \item Shape of output data
    \begin{equation}
        y:~\left(W_o=\frac{W_i-W_f}{S}+1\right)\times\left(H_o=\frac{H_i-H_f}{S}+1\right)\times C
    \end{equation}
    \item Computing output data
    \begin{equation}
        y_{w_o,h_o,c}=\sum_{d=1}^D\sum_{h_f=1}^{H_f}\sum_{w_f=1}^{W_f}W_{c,w_f,h_f,d}\cdot x_{(w_0-1)S+w_f,(h_0-1)S+h_f,d}+b_c
    \end{equation}
    \begin{enumerate}
        \item Reshape $W_c$ to a vector $\tilde{w}$
        \item Extract a $W_f\times H_f\times D$ matrix from $W_c$ to a vector $\tilde{x}$
        \item Compute inner product: $y_{w_o,h_o,c}=\tilde{w}^T\tilde{x}+b_c$
        \item Slide the filter by stride $S$, and repeat the process
        \item Repeat the process by every channel
    \end{enumerate}
    \item Zero padding
    \begin{itemize}
        \item Among input values, border values are less considered then other values
        \item Add extra paddings of 0 on every side of matrix, with width $W_p$ and height $H_p$
        \item Border values are fully considered, weights of extra pads are vanished($\times 0$)
        \item Input shape: $(W_i,H_i,D)\to(W_i+2W_p,H_i+2H_p,D)$
        \item Output shape
        \begin{equation}
            y:~\left(W_o=\frac{W_i+2W_p-W_f}{S}+1\right)\times\left(H_o=\frac{H_i+2H_p-H_f}{S}+1\right)\times C
        \end{equation}
    \end{itemize}
    \item \# of learnable parameters: $C(W_fH_fD+1)$
\end{itemize}

\subsubsection*{Hyperparameters of Convolutional Layer}
\begin{itemize}
    \item Channel size($C$): Provides various perspectives of input data
    \begin{itemize}
        \item Typically powers of 2
    \end{itemize}
    \item Spatial extent($W_f$, $H_f$): Receptive field, spatial information of input
    \begin{itemize}
        \item Typically odd value, $W_f=H_f$
        \item $W_f$, $H_f$ shrinks input; Too fast shrink is not good
    \end{itemize}
    \item Stride($S$)
    \begin{itemize}
        \item Typically 1, $\frac{W_i-W_f}{S},\frac{H_i-H_f}{S}\in\mathbb{N}$
        \item $S$ shrinks input; Too fast shrink is not good
    \end{itemize}
    \item Padding size($W_p$, $H_p$): Typically 0 or $W_p=\frac{1}{2}(W_f-1)$, $H_p=\frac{1}{2}(H_f-1)$
\end{itemize}

\subsubsection*{Convolutional Layer and FC Layer}
\begin{itemize}
    \item FC layer is a special case of Conv. Layer, i.e. $W_f=W_i$, $H_f=H_i$
    \item Conv. layer has less params $\implies$ Easy to optimize
    \item Provides attention on \textit{local patterns}
    \item Enables hierarchial and deep structure
    \item Conv. layer is translation-invariance, i.e. Absolute position of visual features doesn't affect output
\end{itemize}
